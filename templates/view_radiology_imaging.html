{% extends "base.html" %}

{% block title %}Radiology Imaging Records{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px; font-family: 'Arial', sans-serif;">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center; padding: 40px 20px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
        <h1 style="margin: 0; font-size: 2.5em; font-weight: 300; letter-spacing: 2px;">Radiology Imaging Records</h1>
        <p style="margin: 10px 0 0 0; font-size: 1.1em; opacity: 0.9;">Manage patient radiology imaging records</p>
    </div>

    <!-- Search and Add Section -->
    <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 30px; border: 1px solid #f0f0f0;">
        <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 20px;">
            <h3 style="margin: 0; color: #333; font-size: 1.4em;">Search & Filter</h3>
            <a href="{{ url_for('add_radiology_imaging') }}" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 25px; border-radius: 25px; text-decoration: none; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;">
                + Add New Imaging
            </a>
        </div>

        <form method="GET" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Patient Name:</label>
                <input type="text" name="search_patient" value="{{ search_patient or '' }}" 
                       placeholder="Search by patient name..."
                       style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 5px; color: #333; font-weight: 600;">Imaging Name:</label>
                <input type="text" name="search_imaging" value="{{ search_imaging or '' }}" 
                       placeholder="Search by imaging name..."
                       style="width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px; box-sizing: border-box;">
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="submit" style="background: #28a745; color: white; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">
                    Search
                </button>
                <a href="{{ url_for('view_radiology_imaging') }}" style="background: #6c757d; color: white; padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.3s ease;">
                    Clear
                </a>
            </div>
        </form>
    </div>

    <!-- Results Section -->
    <div style="background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid #f0f0f0;">
        {% if radiology_imaging %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);">
                            <th style="padding: 20px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6;">Patient</th>
                            <th style="padding: 20px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6;">Imaging Name</th>
                            <th style="padding: 20px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6;">Date & Time</th>
                            <th style="padding: 20px; text-align: center; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6;">Image</th>
                            <th style="padding: 20px; text-align: center; font-weight: 600; color: #333; border-bottom: 2px solid #dee2e6;">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for imaging in radiology_imaging %}
                        <tr style="border-bottom: 1px solid #f0f0f0; transition: background-color 0.3s ease;" onmouseover="this.style.backgroundColor='#f8f9fa'" onmouseout="this.style.backgroundColor='white'">
                            <td style="padding: 20px;">
                                <div style="font-weight: 600; color: #333; margin-bottom: 4px;">
                                    {{ imaging.patient.first_name }} {{ imaging.patient.last_name }}
                                </div>
                                {% if imaging.patient.date_of_birth %}
                                <div style="color: #6c757d; font-size: 0.9em;">
                                    {{ imaging.patient.date_of_birth.strftime('%Y-%m-%d') }}
                                </div>
                                {% endif %}
                            </td>
                            <td style="padding: 20px;">
                                <div style="color: #333; font-weight: 500;">{{ imaging.name }}</div>
                            </td>
                            <td style="padding: 20px;">
                                <div style="color: #333; font-weight: 500; margin-bottom: 4px;">
                                    {{ imaging.date.strftime('%Y-%m-%d') }}
                                </div>
                                <div style="color: #6c757d; font-size: 0.9em;">
                                    {{ imaging.date.strftime('%I:%M %p') }}
                                </div>
                            </td>
                            <td style="padding: 20px; text-align: center;">
                                {% if imaging.image_filename %}
                                    <img src="{{ url_for('radiology_image', filename=imaging.image_filename) }}" 
                                         alt="Imaging thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: all 0.3s ease;"
                                         onclick="openImageModal('{{ url_for('radiology_image', filename=imaging.image_filename) }}')"
                                         onmouseover="this.style.transform='scale(1.1)'"
                                         onmouseout="this.style.transform='scale(1)'">
                                {% else %}
                                    <div style="color: #adb5bd; font-size: 0.9em; font-style: italic;">No image</div>
                                {% endif %}
                            </td>
                            <td style="padding: 20px; text-align: center;">
                                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                                    <a href="{{ url_for('edit_radiology_imaging', imaging_id=imaging.id) }}" 
                                       style="background: #007bff; color: white; padding: 8px 16px; border-radius: 20px; text-decoration: none; font-size: 0.9em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0,123,255,0.3);">
                                        Edit
                                    </a>
                                    <form method="POST" action="{{ url_for('delete_radiology_imaging', imaging_id=imaging.id) }}" 
                                          style="display: inline;" 
                                          onsubmit="return confirm('Are you sure you want to delete this radiology imaging record for {{ imaging.patient.first_name }} {{ imaging.patient.last_name }}?')">
                                        <button type="submit" 
                                                style="background: #dc3545; color: white; padding: 8px 16px; border: none; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(220,53,69,0.3);">
                                            Delete
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <div style="padding: 20px; background: #f8f9fa; text-align: center; border-top: 1px solid #dee2e6;">
                <p style="margin: 0; color: #6c757d;">
                    <strong>{{ radiology_imaging|length }}</strong> radiology imaging record{% if radiology_imaging|length != 1 %}s{% endif %} found
                </p>
            </div>
        {% else %}
            <div style="padding: 60px; text-align: center;">
                <div style="font-size: 3em; color: #dee2e6; margin-bottom: 20px;">ðŸ“Š</div>
                <h3 style="color: #6c757d; margin-bottom: 15px;">No Radiology Imaging Records Found</h3>
                <p style="color: #adb5bd; margin-bottom: 25px;">
                    {% if search_patient or search_imaging %}
                        No records match your search criteria. Try adjusting your filters.
                    {% else %}
                        Get started by adding your first radiology imaging record.
                    {% endif %}
                </p>
                <a href="{{ url_for('add_radiology_imaging') }}" 
                   style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border-radius: 25px; text-decoration: none; font-weight: 600; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s ease;">
                    Add First Imaging Record
                </a>
            </div>
        {% endif %}
    </div>
</div>

<style>
    /* Hover effects */
    a:hover, button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important;
    }

    /* Focus effects */
    input:focus {
        border-color: #667eea !important;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
        outline: none !important;
    }

    /* Responsive design */
    @media (max-width: 768px) {
        div[style*="max-width: 1200px"] {
            padding: 10px !important;
        }
        
        div[style*="display: flex"] {
            flex-direction: column !important;
            gap: 10px !important;
        }
        
        form[method="GET"] div {
            min-width: auto !important;
        }
        
        table {
            font-size: 0.9em !important;
        }
        
        th, td {
            padding: 10px !important;
        }
        
        div[style*="justify-content: center"] {
            flex-direction: column !important;
            gap: 5px !important;
        }
    }
</style>

<!-- Image Modal -->
<div id="imageModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.9);" onclick="closeImageModal()">
    <div style="position: relative; margin: auto; padding: 0; width: 90%; max-width: 1200px; text-align: center; top: 50%; transform: translateY(-50%);">
        <img id="modalImage" style="width: 100%; height: auto; max-height: 90vh; object-fit: contain;">
        <span onclick="closeImageModal()" style="position: absolute; top: -50px; right: 0; color: #f1f1f1; font-size: 40px; font-weight: bold; cursor: pointer; transition: 0.3s;">&times;</span>
    </div>
</div>

<script>
    function openImageModal(imageSrc) {
        document.getElementById('modalImage').src = imageSrc;
        document.getElementById('imageModal').style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    function closeImageModal() {
        document.getElementById('imageModal').style.display = 'none';
        document.body.style.overflow = 'auto';
    }

    // Close modal when clicking outside the image
    document.getElementById('imageModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeImageModal();
        }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeImageModal();
        }
    });
</script>
{% endblock %}